{% extends 'base.html' %}
{% block head %}
{{super()}}
      <script src="https://cdn.anychart.com/releases/8.0.1/js/anychart-core.min.js"></script>
      <script src="https://cdn.anychart.com/releases/8.0.1/js/anychart-pie.min.js"></script>
   <style>
      .RISE {
         color: crimson;
         font-weight: bold;
      }
      .FALL {
         color: darkblue;
         font-weight: bold;
      }

      .EVEN {
         color: black;
         font-weight: bold;
      }
   </style>
{% endblock %}
{% block content %}
            <button type="button" class="btn btn-labeled btn-primary pull-right">
               <span class="btn-label"><i class="fa fa-dollar"></i>
               </span>Goto Wallet</button>
            <h3>{{g.user[1]}}'s Portfolio
            </h3>
                  <!-- First Row Ends Here -->
                  <div class="row">
                     <div class="col-lg-12">
                        <div class="panel panel-default">
                           <div class="panel-heading">All Markets
                              <a href="javascript:void(0);" data-perform="panel-dismiss" data-toggle="tooltip" title=""
                                 class="pull-right" data-original-title="Close Panel">
                                 <em class="fa fa-times"></em>
                              </a>
                              <a href="javascript:void(0);" data-perform="panel-collapse" data-toggle="tooltip" title=""
                                 class="pull-right" data-original-title="Collapse Panel">
                                 <em class="fa fa-plus"></em>
                              </a>
                           </div>
                           <div class="panel-wrapper collapse">
                              <div class="panel panel-default">
                                 <div class="panel-heading">All Markets |
                                    <small>All Availble Markets</small>
                                 </div>
                                 <div class="panel-body">
                                    <table id="datatable1" class="table table-striped table-hover">
                                       <thead>
                                          <tr>
                                             <th class="tableSmallPad">Coin</th>
                                             <th class="tableSmallPad">Price</th>
                                             <th class="tableSmallPad">Vol</th>
                                             <th class="tableSmallPad">CHG</th>
                                             <th class="tableSmallPad">Name</th>
                                          </tr>
                                       </thead>
                                       <tbody>
                                          <!-- BCH Starts Here -->
                                          <tr class="clickable-row" data-href="index.html">
                                             <td class="tableSmallPad">
                                                <!--RADIO 1-->
                                                <input type="radio" class="radio_item" value="" name="BCH" id="radio1">
                                                <label class="label_item" for="radio1"> <i
                                                      class="fa fa-star text-c-blue"></i> </label> BCH
                                             </td>
                                             <td class="tableSmallPad">0.16000009</td>
                                             <td class="tableSmallPad">2967.720</td>
                                             <td class="text-c-blue tableSmallPad">+17.84</td>
                                             <td class="tableSmallPad">Bitcoin Cash</td>
                                          </tr>
                                          <!-- BCH Ends Here -->
                                          <!-- ETH Starts Here -->
                                          <tr class="clickable-row" data-href="index.html">
                                             <td class="tableSmallPad"><input type="radio" class="radio_item" value=""
                                                   name="ETH" id="radio10">
                                                <label class="label_item" for="radio10"> <i
                                                      class="fa fa-star text-c-blue"></i> </label> ETH
                                             </td>
                                             <td class="tableSmallPad">0.10039995</td>
                                             <td class="tableSmallPad">2887.720</td>
                                             <td class="text-c-blue tableSmallPad">+1.35</td>
                                             <td class="tableSmallPad">Ethereum</td>
                                          </tr>
                                          <!-- ETH Ends Here -->
                                          <!-- XRP Starts Here -->
                                          <tr class="clickable-row" data-href="index.html">
                                             <td class="tableSmallPad"><input type="radio" class="radio_item" value=""
                                                   name="ETH" id="radio3">
                                                <label class="label_item" for="radio3"> <i
                                                      class="fa fa-star text-c-blue"></i> </label> XRP
                                             </td>
                                             <td class="tableSmallPad">0.00009485</td>
                                             <td class="tableSmallPad">1633.576</td>
                                             <td class="text-c-blue tableSmallPad">+5.10</td>
                                             <td class="tableSmallPad">Ripple</td>
                                          </tr>
                                          <!-- XRP Ends Here -->
                                          <!-- STR Starts Here -->
                                          <tr class="clickable-row" data-href="index.html">
                                             <td class="tableSmallPad"><input type="radio" class="radio_item" value=""
                                                   name="ETH" id="radio4">
                                                <label class="label_item" for="radio4"> <i
                                                      class="fa fa-star text-c-blue"></i> </label> STR
                                             </td>
                                             <td class="tableSmallPad">0.00004322</td>
                                             <td class="tableSmallPad">1196.608</td>
                                             <td class="text-c-red tableSmallPad">-0.05</td>
                                             <td class="tableSmallPad">Stellar</td>
                                          </tr>
                                          <!-- STR Ends Here -->
                                          <!-- LTC Starts Here -->
                                          <tr class="clickable-row" data-href="index.html">
                                             <td class="tableSmallPad"><input type="radio" class="radio_item" value=""
                                                   name="ETH" id="radio5">
                                                <label class="label_item" for="radio5"> <i
                                                      class="fa fa-star text-c-blue"></i> </label> LTC
                                             </td>
                                             <td class="tableSmallPad">0.01790003</td>
                                             <td class="tableSmallPad">1115.235</td>
                                             <td class="text-c-blue tableSmallPad">+1.58</td>
                                             <td class="tableSmallPad">Litecoin</td>
                                          </tr>
                                          <!-- LTC Ends Here -->
                                          <!-- SC Starts Here -->
                                          <tr class="clickable-row" data-href="index.html">
                                             <td class="tableSmallPad"><input type="radio" class="radio_item" value=""
                                                   name="ETH" id="radio6">
                                                <label class="label_item" for="radio6"> <i
                                                      class="fa fa-star text-c-blue"></i> </label> SC
                                             </td>
                                             <td class="tableSmallPad">0.00000272</td>
                                             <td class="tableSmallPad">131.014</td>
                                             <td class="text-c-blue tableSmallPad">+1.87</td>
                                             <td class="tableSmallPad">Siacoin</td>
                                          </tr>
                                          <!-- SC Ends Here -->
                                          <!-- Doge Starts Here -->
                                          <tr class="clickable-row" data-href="index.html">
                                             <td class="tableSmallPad"><input type="radio" class="radio_item" value=""
                                                   name="ETH" id="radio7">
                                                <label class="label_item" for="radio7"> <i
                                                      class="fa fa-star text-c-blue"></i> </label> DOGE
                                             </td>
                                             <td class="tableSmallPad">0.00000055</td>
                                             <td class="tableSmallPad">169.631</td>
                                             <td class="text-c-red tableSmallPad">-1.79</td>
                                             <td class="tableSmallPad">Dogecoin</td>
                                          </tr>
                                          <!-- Doge Ends Here -->
                                          <!-- DBG Starts Here -->
                                          <tr class="clickable-row" data-href="index.html">
                                             <td class="tableSmallPad"><input type="radio" class="radio_item" value=""
                                                   name="ETH" id="radio8">
                                                <label class="label_item" for="radio8"> <i
                                                      class="fa fa-star text-c-blue"></i> </label> DGB
                                             </td>
                                             <td class="tableSmallPad">0.00000402</td>
                                             <td class="tableSmallPad">90.224</td>
                                             <td class="text-c-blue tableSmallPad">+0.00</td>
                                             <td class="tableSmallPad">DigiByte</td>
                                          </tr>
                                          <!-- DGB Ends Here -->
                                          <!-- NXT Starts Here -->
                                          <tr class="clickable-row" data-href="index.html">
                                             <td class="tableSmallPad"><input type="radio" class="radio_item" value=""
                                                   name="ETH" id="radio9">
                                                <label class="label_item" for="radio9"> <i
                                                      class="fa fa-star text-c-blue"></i> </label> NXT
                                             </td>
                                             <td class="tableSmallPad">0.00002241</td>
                                             <td class="tableSmallPad">100.305</td>
                                             <td class="text-c-blue tableSmallPad">+2.56</td>
                                             <td class="tableSmallPad">NXT</td>
                                          </tr>
                                          <!-- NXT Ends Here -->
                                       </tbody>
                                    </table>
                                 </div>
                              </div>
                              <div class="panel-footer">All Markets</div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <!-- Chart Starts Here -->
                  <div class="row">
                     <div class="col-lg-12">
                        <div class="panel panel-default">
                           <div class="panel-collapse">
                              <div class="panel-body">
                                 <h4>Your Portfolio</h4>

                                 <div style="display: flex;">
                                    <div class="panel-body bg-success">
                              <div class="row row-table row-flush">
                                 <div class="col-xs-12">
                                    <h4 class="m0">Available KRW</h4>
                                    <h4 class="User_krw"><i class="fa fa-krw">&nbsp</i>{{"{:,}".format(budget|int)}}</h4>
                                 </div>
                              </div>
                           </div>

                                 <div class="panel-body bg-primary">
                                    <div class="row row-table row-flush">
                                       <div class="col-xs-12">
                                    <h4 class="m0">Total Asset</h4>
                                          <h4 class="User_asset" id="User_asset"><i class="fa fa-krw">&nbsp</i></h4>
                                    </div>
                                    </div>
                                 </div>
                                 </div>
                                     <div id="piechart" style="width: 100%; height: 500px"></div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <!-- Chart Ends Here -->
              
                  <!-- Coin Status Ends Here -->
               
            <!-- Orders Book -->
               <!-- Open Orders -->
               <div class="col-md-12">
                  <div class="panel panel-default">
                     <div class="panel-heading">My Holdings
                        <a href="#" data-perform="panel-collapse" data-toggle="tooltip" title="Collapse Panel"
                           class="pull-right">
                           <em class="fa fa-minus"></em>
                        </a>
                     </div>
                     <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                           <thead>
                              <tr>
                                 <th>Code</th>
                                 <th>Name</th>
                                 <th>Amount</th>
                                 <th>Average Purchase Price</th>
                                 <th>Total Purchase Price</th>
                                 <th>Trade Price</th>
                                 <th>Evaluation</th>
                                 <th>Rate of Return</th>
                              </tr>
                           </thead>
                           <tbody>
                              {% for coin in holdings %}
                              <tr id="{{coin[0]}}" style="cursor:pointer;" onClick="location.href='./prices/{{coin[0]}}'">
                                 <td>{{coin[0]}}</td>
                                 <td>{{coin[1]}}</td>
                                 <td>{{coin[2]}}&nbsp;{{coin[0].split("KRW-")[1]}}</td>
                                 <td>&#8361;{{coin[3]|int}}</td>
                                 <td>&#8361;{{(coin[2]*coin[3])|int}}</td>
                                 <td></td>
                                 <td></td>
                                 <td></td>
                              </tr>
                              {% endfor %}
                           </tbody>
                        </table>
                     </div>
                  </div>
               </div>
               <!-- Market History -->
               <!-- My Order History -->
          
            </div>
            </div>
   {% endblock %}
   {% block script %}
   <script src="{{ url_for('static', filename='plugins/jquery/jquery.js') }}"></script>
   <script src="{{ url_for('static', filename='plugins/velocity/velocity.js') }}"></script>
   <script src="{{ url_for('static', filename='plugins/velocity/velocity.ui.js') }}"></script>
   <script src="{{ url_for('static', filename='plugins/bootstrap/js/bootstrap.js') }}"></script>
   <script src="{{ url_for('static', filename='plugins/chosen/chosen.jquery.js') }}"></script>
   <script src="{{ url_for('static', filename='plugins/slider/js/bootstrap-slider.js') }}"></script>
   <script src="{{ url_for('static', filename='plugins/filestyle/bootstrap-filestyle.js') }}"></script>
   <script src="{{ url_for('static', filename='plugins/animo/animo.js') }}"></script>
   <script src="{{ url_for('static', filename='plugins/sparklines/jquery.sparkline.js') }}"></script>
   <script src="{{ url_for('static', filename='plugins/slimscroll/jquery.slimscroll.js') }}"></script>
   
   <script src="{{ url_for('static', filename='plugins/datatable/media/js/jquery.dataTables.js') }}"></script>
   <script src="{{ url_for('static', filename='plugins/datatable/extensions/datatable-bootstrap/js/dataTables.bootstrap.js') }}"></script>
   <script src="{{ url_for('static', filename='plugins/datatable/extensions/datatable-bootstrap/js/dataTables.bootstrapPagination.js') }}"></script>
   <script src="{{ url_for('static', filename='tradify/highcharts.js') }}"></script>
   <script src="{{ url_for('static', filename='tradify/exporting.js') }}"></script>
   <script src="{{ url_for('static', filename='plugins/datatable/extensions/ColVis/js/dataTables.colVis.js') }}"></script>
   <script src="{{ url_for('static', filename='app/js/tradify.js') }}"></script>
   <!--[if lt IE 8]><script src="js/excanvas.min.js"></script><![endif]-->
   <script>
      $(document).ready(function () {
         // Candlestick
         $.getJSON('tradify/data.json', function (data) {

            // create the chart
            Highcharts.stockChart('candlestickChart', {

               chart: {
               },


               rangeSelector: {
                  selected: 1
               },

               series: [{
                  type: 'candlestick',
                  name: 'SC-BTC',
                  data: data,
                  dataGrouping: {
                     units: [
                        [
                           'week', // unit name
                           [1] // allowed multiples
                        ], [
                           'month',
                           [1, 2, 3, 4, 6]
                        ]
                     ]
                  }
               }]
            });
         });
      });
   </script>
   <script>
anychart.onDocumentReady(function() {
  var data = [
      {x: "KRW", value: {{budget}}},
      {% for coin in holdings %}
      {x: "{{coin[1]}}", value: {{coin[2]*coin[3]}}},
      {% endfor %}
  ];

  // create the chart
  var chart = anychart.pie();

  // set the chart title
  //chart.title("Population by Race for the United States: 2010 Census");

  // add the data
  chart.data(data);

  // display the chart in the container
  chart.container('piechart');
  chart.draw();
});
   </script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"
      integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA=="
      crossorigin="anonymous"></script>
   <script type="text/javascript" charset="utf-8">
      var socket = io();
      socket.on('connect', function () {
         socket.emit('my holdings', data = {{holdings | tojson}});
         setInterval(function () { socket.emit('my holdings', data = {{holdings | tojson}}); }, 1000);
      });
      socket.on('json', function (data) {
         var totalAsset = parseInt({{budget}});
         if ((data !== undefined) && (data !== null)) {
         for (const [key, value] of Object.entries(data)) {
              {% for coin in holdings %}
              if(key == "{{coin[0]}}"){
              document.getElementById(key).children[5].innerHTML = "&#8361;"+value[0].toLocaleString(); // trade price column
              document.getElementById(key).children[6].innerHTML = "&#8361;"+parseInt(value[0]*{{coin[2]}}).toLocaleString(); //valuation column
              var rate = ((value[0] / {{coin[3]}})-1)*100; // rate of return calculation
              if(rate < 0){ // Row Color based on rate of return
              document.getElementById(key).children[7].innerHTML = rate.toFixed(2).toLocaleString() + "%";
               document.getElementById(key).setAttribute('class', 'FALL');
              }
              else if(rate > 0){
               document.getElementById(key).children[7].innerHTML = "+" + rate.toFixed(2).toLocaleString() + "%";
               document.getElementById(key).setAttribute('class', 'RISE');
              }
              else{
               document.getElementById(key).children[7].innerHTML = rate.toFixed(2).toLocaleString() + "%";
               document.getElementById(key).setAttribute('class', 'EVEN');
              }
              totalAsset += parseInt(value[0]*parseFloat({{coin[2]}}));
              }
              {% endfor %}
         }
         }
         document.getElementById("User_asset").innerHTML = "<i class ='fa fa-krw'>&nbsp</i>" + totalAsset.toLocaleString();
      });
   </script>
   {% endblock %}